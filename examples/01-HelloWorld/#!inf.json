{
    "#": "gi0.PINF.it/core/v0",

    "#": {
        "/.extension.built": "to.pinf.org.mozilla.web-ext",
        "runner": "it.pinf.org.mozilla.web-ext"
    },
    ":builder:": "/.extension.built @ builder/v1",
    ":runner:": "runner @ runner/v0",

    "gi0.PINF.it/build/v0 @ # /.extension.built": (inf () >>>
        {
            "gi0.PINF.it/build/v0 @ # :builder: build() /": {

                "manifest": {
                    "permissions": [
                        "webRequest",
                        "<all_urls>"
                    ],
                    "background": {
                        "scripts": [
                            "bg-worker1.js",
                            "bg-worker2.js"
                        ]
                    }
                },
                "routes": {
                    "^/": (javascript (API) >>>

                        var results = {
                            "page": null,
                            "bg-worker1": null,
                            "bg-worker2": null
                        };
            
                        return function (req, res, next) {
            
                            if (/^\/\.result$/.test(req.url)) {
            
                                var allResultsIn = false;
                                function recordResult (name, value) {
            
                                    results[name] = value;
            
                                    if (
                                        Object.keys(results).filter(function (suite) {
                                            return (!results[suite]);
                                        }).length === 0 &&
                                        !allResultsIn
                                    ) {
                                        allResultsIn = true;
                                        console.log("RESULTS:", JSON.stringify(results, null, 4))
            
                                        if (process.env.BO_TEST_FLAG_DEV) {
                                            console.log("NOTE: Leaving browser open due to '--dev'.");
                                        } else {
                                            API.SERVER.stop();
                                        }
                                    }
                                }
            
                                recordResult(req.body.suite, req.body.result);
            
                                res.writeHead(200, {
                                    "Content-Type": "application/json"
                                });
                                res.end('{}');
                            }
            
                            res.end(`
                                <html>
                                    <body>OK!</body>
                                    <script>
                                        window.fetch('/.result', {
                                            method: 'post',
                                            headers: {
                                                'Accept': 'application/json',
                                                'Content-Type': 'application/json'
                                            },
                                            body: JSON.stringify({
                                                suite: 'page',
                                                result: 'all good'
                                            })
                                        });
                                    </script>
                                </html>
                            `);
                        };
                    <<<)
                }
            }
        }
    <<<),

    "gi0.PINF.it/build/v0 @ # onDone()": (inf () >>>
        {
            "gi0.PINF.it/core/v0 @ # :runner: set() extensionPath": ".extension.built",

            "gi0.PINF.it/core/v0 @ # :runner: run()": ""
        }
    <<<)
}